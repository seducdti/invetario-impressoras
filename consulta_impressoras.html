<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Consulta Impressoras</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header class="topbar">
    <h1>Consulta de Impressoras</h1>
    <nav>
        <a class="nav-link" href="index.html">Home</a>
        <a class="nav-link" href="cadastro_impressora.html">Cadastro Impressora</a>
        <a class="nav-link" href="manutencao.html">Cadastro Manuten√ß√£o</a>
        <a class="nav-link active" href="consulta_impressoras.html">Consultar Impressoras</a>
        <a class="nav-link" href="consulta_manutencoes.html">Consultar Manuten√ß√µes</a>
    </nav>
</header>

<main class="container">
<section class="card">
<h2>Lista de Impressoras</h2>
    <button onclick="gerarPDF()">üìÑ Gerar Relat√≥rio PDF</button>
 <input 
  type="text" 
  id="pesquisa" 
  placeholder="Pesquisar por modelo, escola, setor ou toner..."
  class="campo-pesquisa"
/>

<div id="lista"></div>
</section>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  doc,
  deleteDoc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAM_O0w1wWILJh0SEQMjavN9L2gRSRnbgA",
  authDomain: "inventario-impressoras-d9d58.firebaseapp.com",
  projectId: "inventario-impressoras-d9d58",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const lista = document.getElementById("lista");

async function carregar() {
  const snap = await getDocs(collection(db, "impressoras"));

  if (snap.empty) {
    lista.innerHTML = "<p>Nenhuma impressora cadastrada.</p>";
    return;
  }

  let html = "";

  snap.forEach(docSnap => {
    const d = docSnap.data();

    html += `
    <div class="manutencao-card">
      <h3>${d.modelo}</h3>
      <p><strong>Toner:</strong> ${d.toner}</p>
      <p><strong>Escola:</strong> ${d.escola || "-"}</p>
      <p><strong>Setor:</strong> ${d.setor || "-"}</p>
      <p><strong>Propriedade:</strong> ${d.propriedade}</p>

      <div class="acoes">
        <button onclick="editar('${docSnap.id}')">‚úèÔ∏è Editar</button>
        <button onclick="excluir('${docSnap.id}')">üóë Excluir</button>
      </div>
    </div>
    `;
  });

  lista.innerHTML = html;
}

window.excluir = async (id) => {
  if (!confirm("Excluir esta impressora?")) return;
  await deleteDoc(doc(db, "impressoras", id));
  carregar();
};
    window.gerarPDF = async () => {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  const snap = await getDocs(collection(db, "impressoras"));

  const dados = [];

  snap.forEach(doc => {
    const d = doc.data();
    dados.push([
      d.modelo,
      d.toner,
      d.escola || "-",
      d.setor || "-",
      d.propriedade
    ]);
  });

  pdf.text("Relat√≥rio de Impressoras", 14, 15);

  pdf.autoTable({
    head: [["Modelo", "Toner", "Escola", "Setor", "Propriedade"]],
    body: dados,
    startY: 20
  });

  pdf.save("relatorio-impressoras.pdf");
};


window.editar = async (id) => {
  const novoModelo = prompt("Modelo:");
  if (!novoModelo) return;

  const novoToner = prompt("Toner:");
  const novaEscola = prompt("Escola:");
  const novoSetor = prompt("Setor:");
  const novaPropriedade = prompt("Propriedade (Pr√≥pria / Alugada):");

  await updateDoc(doc(db, "impressoras", id), {
    modelo: novoModelo,
    toner: novoToner || "",
    escola: novaEscola || "",
    setor: novoSetor || "",
    propriedade: novaPropriedade || ""
  });

  alert("Impressora atualizada!");
  carregar();
};

carregar();
</script>



</body>
</html>
